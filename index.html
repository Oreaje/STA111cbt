<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>OAU CBT Simulator - Secure Mode</title>
    <style>
        :root { --primary: #e11d48; --bg: #0f172a; --card: #1e293b; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; padding: 20px; margin: 0; user-select: none; }
        .container { width: 95%; max-width: 900px; background: var(--card); padding: 25px; border-radius: 12px; box-shadow: 0 10px 15px rgba(0,0,0,0.5); }
        
        /* Setup Screen */
        #setupScreen { text-align: center; animation: fadeIn 0.5s; }
        .input-group { margin: 20px 0; text-align: left; max-width: 320px; margin-left: auto; margin-right: auto; }
        label { font-size: 0.9rem; color: #94a3b8; }
        input { width: 100%; padding: 12px; border-radius: 6px; border: 2px solid #334155; margin-top: 8px; font-size: 16px; background: #0f172a; color: white; outline: none; }
        input:focus { border-color: var(--primary); }
        .limit-note { font-size: 0.75rem; color: #e11d48; margin-top: 4px; display: block; }
        
        /* Exam Elements */
        #examArea { display: none; }
        h2 { text-align: center; color: var(--primary); margin-top: 0; }
        #timer { text-align: center; font-size: 26px; margin: 15px; color: #22c55e; font-weight: bold; font-family: monospace; }
        
        .option { display: block; background: var(--bg); margin: 10px 0; padding: 12px 15px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .selected { background: #334155; border-color: var(--primary); }
        .correct { background: #064e3b !important; border-color: #22c55e !important; color: #adfaad; }
        .wrong { background: #7f1d1d !important; border-color: #ef4444 !important; color: #fca5a5; }

        .palette { display: grid; grid-template-columns: repeat(10, 1fr); gap: 6px; margin: 20px 0; max-height: 150px; overflow-y: auto; padding: 5px; }
        .palette button { padding: 8px 2px; border: none; cursor: pointer; background: #475569; color: white; border-radius: 4px; }
        .palette-correct { background: #22c55e !important; }
        .palette-wrong { background: #e11d48 !important; }
        .current { background: var(--primary) !important; outline: 2px solid white; }

        .controls { display: flex; gap: 10px; margin-top: 20px; }
        button.btn { flex: 1; padding: 15px; font-weight: bold; cursor: pointer; border: none; border-radius: 8px; color: white; text-transform: uppercase; }
        .btn-start { background: #22c55e; width: 100%; }
        .prev { background: #64748b; }
        .next { background: #2563eb; }
        .submit { background: var(--primary); }
        
        #resultBanner { display: none; text-align: center; background: #334155; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #2563eb; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="container">
    <div id="setupScreen">
        <h2>EXAM CONFIGURATION</h2>
        <p>Pool Size: <span id="poolSize">0</span> Questions</p>
        
        <div class="input-group">
            <label>Number of Questions:</label>
            <input type="number" id="userQty" value="40" min="1" max="100">
            <span class="limit-note">* Maximum allowed: 100</span>
        </div>
        
        <div class="input-group">
            <label>Time Limit (Minutes):</label>
            <input type="number" id="userTime" value="60" min="1" max="60">
            <span class="limit-note">* Maximum allowed: 60</span>
        </div>
        
        <button class="btn btn-start" onclick="startExam()">START EXAMINATION</button>
    </div>

    <div id="examArea">
        <h2 id="examTitle">OAU STA 111 CBT</h2>
        <div id="resultBanner">
            <h1 id="scoreDisplay"></h1>
            <p id="percentDisplay"></p>
            <button class="btn next" onclick="location.reload()">RETAKE NEW EXAM</button>
        </div>
        <div id="timer">60:00</div>
        <div id="palette" class="palette"></div>
        <div id="questionBox"></div>
        <div class="controls">
            <button class="btn prev" onclick="prevQ()">PREVIOUS</button>
            <button class="btn next" onclick="nextQ()">NEXT</button>
            <button id="submitBtn" class="btn submit" onclick="submitExam()">SUBMIT</button>
        </div>
    </div>
</div>

<script> 
const MAX_QS = 100;
const MAX_TIME = 60;

const QUESTION_POOL = [
    
    { q: "Data collected by a researcher through direct observation is called:", o: ["Secondary data", "Primary data", "Tertiary data", "Processed data"], a: "Primary data" },
    { q: "Which of the following is an example of secondary data?", o: ["Data from a questionnaire you designed", "Census reports from the government", "Measurements you took in a laboratory", "Responses from interviews you conducted"], a: "Census reports from the government" },
    { q: "The midpoint of a class interval 25–35 is:", o: ["29", "30", "29.5", "30.5"], a: "30" },
    { q: "In a frequency distribution, the class boundaries for the class 40–49 (assuming continuity correction) are:", o: ["40 and 49", "39.5 and 49.5", "40.5 and 49.5", "39.5 and 48.5"], a: "39.5 and 49.5" },
    { q: "Blood group (A, B, AB, O) is an example of:", o: ["Continuous data", "Discrete data", "Nominal data", "Ordinal data"], a: "Nominal data" },
    { q: "The cumulative frequency of a class is 45 and the cumulative frequency of the previous class is 28. The frequency of the class is:", o: ["73", "45", "28", "17"], a: "17" },
    { q: "A frequency distribution has classes 10-19, 20-29, 30-39, 40-49, 50-59 with frequencies 4, 8, 15, 10, 3 respectively. The relative frequency of the modal class is:", o: ["15%", "37.5%", "0.375", "0.15"], a: "0.375" },
    { q: "Which of the following is NOT an advantage of primary data?", o: ["Accuracy and reliability", "Specific to research needs", "Cost-effectiveness", "Current and up-to-date"], a: "Cost-effectiveness" },
    { q: "In a grouped frequency distribution with class width 10, if the upper boundary of a class is 64.5, the class mark is:", o: ["60", "59.5", "59", "64"], a: "59.5" },
    { q: "Number of students in a class is an example of:", o: ["Continuous variable", "Discrete variable", "Qualitative variable", "Attribute"], a: "Discrete variable" },
    { q: "The ogive is a graph of:", o: ["Frequency vs class mark", "Cumulative frequency vs upper class boundary", "Relative frequency vs class mark", "Frequency vs lower class boundary"], a: "Cumulative frequency vs upper class boundary" },
    { q: "In a frequency distribution with 6 classes, each of width 5, if the lower limit of the first class is 12, the upper boundary of the last class is:", o: ["42", "41.5", "42.5", "41"], a: "42" },
    { q: "The arithmetic mean of 5, 10, 15, 20, 25 is:", o: ["10", "15", "20", "75"], a: "15" },
    { q: "The median of 3, 7, 2, 9, 5, 8, 1 is:", o: ["9", "5", "7", "2"], a: "5" },
    { q: "The mode of 4, 5, 5, 6, 7, 5, 8, 5, 9 is:", o: ["4", "5", "6", "9"], a: "5" },
    { q: "The mean of a dataset is 25. If each value is increased by 5, the new mean is:", o: ["25", "30", "125", "20"], a: "30" },
    { q: "The mean of 10 observations is 15. If one observation 20 is removed, the mean of the remaining 9 observations is:", o: ["14.44", "15.56", "13.89", "16.11"], a: "14.44" },
    { q: "The mean of n observations is x̄. If each observation is multiplied by 2 and then 3 is added, the new mean is:", o: ["2x̄", "2x̄+3", "2(x̄+3)", "x̄+3"], a: "2x̄+3" },
    { q: "For a frequency distribution, if Σ fx = 420 and Σ f = 30, then the mean is:", o: ["12,600", "14", "450", "390"], a: "14" },
    { q: "The mean of 5 numbers is 18. If one number is excluded, the mean becomes 16. The excluded number is:", o: ["26", "24", "22", "28"], a: "26" },
    { q: "In a grouped frequency distribution, the median class is determined by:", o: ["The class with highest frequency", "The class where cumulative frequency first exceeds n/2", "The middle class", "The class with lowest frequency"], a: "The class where cumulative frequency first exceeds n/2" },
    { q: "For a grouped frequency distribution with n = 100, if the cumulative frequency before the median class is 38, the frequency of the median class is 24, lower boundary is 50, and class width is 10, the median is:", o: ["55", "52", "57.5", "54.17"], a: "55" },
    { q: "For a symmetric distribution:", o: ["Mean > Median > Mode", "Mean < Median < Mode", "Mean = Median = Mode", "Mean = Mode ≠ Median"], a: "Mean = Median = Mode" },
    { q: "The empirical relationship between mean, median, and mode is:", o: ["Mode = 3 × Mean − 2 × Median", "Mode = 3 × Median − 2 × Mean", "Mode = 2 × Median − 3 × Mean", "Mode = Mean + Median"], a: "Mode = 3 × Median − 2 × Mean" },
    { q: "The geometric mean of 4, 8, and 16 is:", o: ["8", "9.33", "28", "4"], a: "8" },
    { q: "The harmonic mean of 2 and 8 is:", o: ["5", "4", "3.2", "16"], a: "3.2" },
    { q: "If the arithmetic mean of two numbers is 5 and their geometric mean is 4, the numbers are:", o: ["2 and 8", "1 and 9", "4 and 6", "3 and 7"], a: "2 and 8" },
    { q: "Which measure of central tendency is NOT affected by extreme values?", o: ["Mean", "Median", "Weighted mean", "Geometric mean"], a: "Median" },
    { q: "The combined mean of two groups with means 30 and 40, and sizes 20 and 30 respectively, is:", o: ["35", "36", "34", "38"], a: "36" },
    { q: "In a moderately skewed distribution, Mean = 45 and Mode = 36. The median is approximately:", o: ["40", "42", "44", "38"], a: "42" },
    { q: "Using assumed mean method, if A = 50, Σ fd = −40, and n = 20, the actual mean is:", o: ["52", "48", "50", "90"], a: "48" },
    { q: "The modal class has frequency 30, the class before has frequency 18, and the class after has frequency 22. If L = 40 and h = 10, the mode is:", o: ["46", "44", "48", "50"], a: "46" },
    { q: "The sum of deviations of all observations from their arithmetic mean is always:", o: ["Maximum", "Minimum", "Zero", "One"], a: "Zero" },
    { q: "If x̄ is the mean of x1,x2, ...,xn, then Σ(xi−x̄)² is:", o: ["Maximum", "Minimum", "Zero", "Undefined"], a: "Minimum" },
    { q: "For a grouped frequency distribution, the step deviation method uses u = (x−A)/h. If Σ fu = −12, n = 60, A = 35, and h = 5, the mean is:", o: ["34", "36", "33", "37"], a: "34" },
    { q: "The range of the data 12, 15, 18, 22, 25, 30 is:", o: ["30", "12", "18", "42"], a: "18" },
    { q: "Variance is the square of:", o: ["Mean", "Range", "Standard deviation", "Mean deviation"], a: "Standard deviation" },
    { q: "If the variance of a dataset is 16, the standard deviation is:", o: ["4", "256", "8", "2"], a: "4" },
    { q: "The mean deviation from the mean for data 2, 4, 6, 8, 10 (with mean = 6) is:", o: ["2.4", "4", "0", "6"], a: "2.4" },
    { q: "For a population with values 4, 7, 10, 13, 16, the variance is:", o: ["18", "22.5", "4.24", "16"], a: "18" },
    { q: "Which measure of dispersion is NOT affected by extreme values?", o: ["Range", "Standard deviation", "Quartile deviation", "Mean deviation"], a: "Quartile deviation" },
    { q: "The coefficient of variation is calculated as:", o: ["(x̄/σ) × 100", "(σ/x̄) × 100", "σ²/x̄", "x̄/σ²"], a: "(σ/x̄) × 100" },
    { q: "Two datasets have the following statistics: Dataset A: Mean = 50, SD = 10; Dataset B: Mean = 100, SD = 15. Which dataset has greater relative variability?", o: ["Dataset A", "Dataset B", "Both are equal", "Cannot be determined"], a: "Dataset A" },
    { q: "If every observation in a dataset is multiplied by 3, the standard deviation:", o: ["Remains unchanged", "Is multiplied by 3", "Is multiplied by 9", "Is divided by 3"], a: "Is multiplied by 3" },
    { q: "If every observation is increased by a constant k, the variance:", o: ["Increases by k", "Increases by k²", "Remains unchanged", "Decreases by k"], a: "Remains unchanged" },
    { q: "The standard deviation of 5, 5, 5, 5, 5 is:", o: ["5", "25", "1", "0"], a: "0" },
    { q: "For a sample of size n, the sample variance uses:", o: ["n in the denominator", "n−1 in the denominator", "n+1 in the denominator", "2n in the denominator"], a: "n−1 in the denominator" },
    { q: "If Σ x = 50, Σ x² = 550, and n = 10, the population variance is:", o: ["30", "25", "55", "5"], a: "30" },
    { q: "The mean deviation is minimum when calculated from:", o: ["Mean", "Median", "Mode", "Any value"], a: "Median" },
    { q: "For a grouped frequency distribution, if Σ fx² = 8500, Σ fx = 400, and Σ f = 50, the variance is:", o: ["106", "10.30", "170", "6"], a: "106" },
    { q: "Standard deviation has the same unit as:", o: ["Variance", "Original data", "Coefficient of variation", "None of the above"], a: "Original data" },
    { q: "If the CV of dataset X is 25% and mean is 80, the standard deviation is:", o: ["20", "3.2", "320", "0.3125"], a: "20" },
    { q: "The combined variance of two groups with n₁ = 50, x̄₁ = 40, σ₁² = 25 and n₂ = 50, x̄₂ = 50, σ₂² = 36, is:", o: ["30.5", "55.5", "25", "36"], a: "55.5" },
    { q: "Which relationship is ALWAYS true?", o: ["AM ≥ GM ≥ HM", "AM ≤ GM ≤ HM", "GM ≥ AM ≥ HM", "HM ≥ GM ≥ AM"], a: "AM ≥ GM ≥ HM" },
    { q: "If the mean of a distribution is 100 and coefficient of variation is 30%, the variance is:", o: ["30", "900", "0.3", "3000"], a: "30" },
    { q: "Range is defined as:", o: ["Largest value + Smallest value", "Largest value − Smallest value", "Largest value × Smallest value", "Largest value ÷ Smallest value"], a: "Largest value − Smallest value" },
    { q: "The quartile deviation is also known as:", o: ["Inter-quartile range", "Semi-interquartile range", "Range", "Mean deviation"], a: "Semi-interquartile range" },
    { q: "A dataset has mean = 25 and variance = 9. If each observation is first doubled and then 5 is subtracted, the new variance is:", o: ["36", "9", "13", "31"], a: "36" },
    { q: "The sum of squared deviations from the mean is:", o: ["Maximum", "Minimum", "Zero", "Equal to range"], a: "Minimum" },
    { q: "For two distributions with the same mean but different standard deviations, the distribution with larger SD is:", o: ["More consistent", "Less consistent", "More peaked", "More skewed"], a: "Less consistent" },
    { q: "The second quartile (Q₂) is the same as:", o: ["Mean", "Mode", "Median", "Range"], a: "Median" },
    { q: "Quartiles divide data into:", o: ["2 equal parts", "4 equal parts", "10 equal parts", "100 equal parts"], a: "4 equal parts" },
    { q: "If Q₁ = 25 and Q₃ = 45, the interquartile range (IQR) is:", o: ["70", "20", "10", "35"], a: "20" },
    { q: "The position of Q₃ in a dataset of 20 observations is:", o: ["15", "15.75", "15.25", "16"], a: "15.75" },
    { q: "For a grouped frequency distribution with n = 80, the position for locating P₆₅ is:", o: ["52", "65", "48.75", "53.3"], a: "52" },
    { q: "D₅ is equivalent to:", o: ["P₅", "P₅₀", "Q₂", "Both (B) and (C)"], a: "Both (B) and (C)" },
    { q: "If the cumulative frequency just before the Q₁ class is 12, the frequency of the Q₁ class is 18, L = 20, h = 10, and n = 60, then Q₁ is:", o: ["21.67", "23.33", "25", "20.83"], a: "21.67" },
    { q: "The semi-interquartile range (quartile deviation) for Q₁ = 30, Q₂ = 45, Q₃ = 60 is:", o: ["30", "15", "45", "7.5"], a: "15" },
    { q: "P₂₅ is equal to:", o: ["Q₁", "Q₂", "Q₃", "D₂.₅"], a: "Q₁" },
    { q: "For a dataset with Q₁ = 20, Q₂ = 35, Q₃ = 60, the coefficient of quartile deviation is:", o: ["0.5", "0.67", "0.33", "1.0"], a: "0.5" },
    { q: "The 7th decile (D₇) means:", o: ["70% of data lies below this value", "30% of data lies below this value", "7% of data lies below this value", "70% of data lies above this value"], a: "70% of data lies below this value" },
    { q: "In a dataset of 50 observations, the position of D₄ is:", o: ["4", "20", "20.4", "46"], a: "20.4" },
    { q: "If P₉₀ = 85 and P₁₀ = 35, the percentile range is:", o: ["120", "50", "60", "25"], a: "50" },
    { q: "Which statement is TRUE?", o: ["Q₂ = D₅ = P₅₀", "Q₁ = D₂ = P₂₀", "Q₃ = D₈ = P₈₀", "Q₂ = D₄ = P₄₀"], a: "Q₂ = D₅ = P₅₀" },
    { q: "For a grouped distribution, if the Q₃ class has L = 50, cf_b = 60, f = 25, h = 10, and n = 100, then Q₃ is:", o: ["56", "54", "58", "52"], a: "56" },
    { q: "In a positively skewed distribution:", o: ["Mean = Median = Mode", "Mean < Median < Mode", "Mode < Median < Mean", "Median < Mode < Mean"], a: "Mode < Median < Mean" },
    { q: "Kurtosis measures:", o: ["Central tendency", "Asymmetry", "Peakedness and tail heaviness", "Dispersion"], a: "Peakedness and tail heaviness" },
    { q: "Pearson’s coefficient of skewness using mode is:", o: ["(Mean−Mode)/Variance", "(Mean−Mode)/SD", "3(Mean−Median)/SD", "Both (B) and (C)"], a: "Both (B) and (C)" },
    { q: "A distribution with β₂ = 3 is called:", o: ["Leptokurtic", "Platykurtic", "Mesokurtic", "Skewed"], a: "Mesokurtic" },
    { q: "If Mean = 50, Median = 48, and SD = 10, Pearson’s coefficient of skewness (using median) is:", o: ["0.2", "0.6", "0.4", "2.0"], a: "0.6" },
    { q: "The first central moment (μ₁) is always equal to:", o: ["Mean", "Variance", "Zero", "One"], a: "Zero" },
    { q: "If Q₁ = 20, Q₂ = 30, Q₃ = 50, the Bowley’s coefficient of skewness is:", o: ["0.33", "0.67", "-0.33", "0.5"], a: "0.33" },
    { q: "A distribution with γ₂ < 0 (excess kurtosis negative) is:", o: ["Leptokurtic", "Mesokurtic", "Platykurtic", "Positively skewed"], a: "Platykurtic" },
    { q: "The moment coefficient of skewness is:", o: ["γ₁ = μ₃/σ³", "γ₁ = μ₄/σ⁴", "γ₁ = μ₂/σ²", "γ₁ = μ₃/σ²"], a: "γ₁ = μ₃/σ³" },
    { q: "For a normal distribution:", o: ["γ₁ = 0, β₂ = 0", "γ₁ = 0, β₂ = 3", "γ₁ = 3, β₂ = 0", "γ₁ = 1, β₂ = 1"], a: "γ₁ = 0, β₂ = 3" },
    { q: "The second central moment (μ₂) equals:", o: ["Mean", "Variance", "Standard deviation", "Skewness"], a: "Variance" },
    { q: "If μ₄ = 48 and σ = 2, then β₂ is:", o: ["3", "12", "24", "6"], a: "3" },
    { q: "A distribution with a long left tail is:", o: ["Positively skewed (right-skewed)", "Negatively skewed (left-skewed)", "Symmetric", "Leptokurtic"], a: "Negatively skewed (left-skewed)" },
    { q: "Laspeyres index uses:", o: ["Current year quantities as weights", "Base year quantities as weights", "Average of both year quantities", "No weights"], a: "Base year quantities as weights" },
    { q: "Fisher’s index is called “ideal” because it satisfies:", o: ["Time Reversal Test only", "Factor Reversal Test only", "Both Time and Factor Reversal Tests", "Circular Test"], a: "Both Time and Factor Reversal Tests" },
    { q: "If Laspeyres Index = 120 and Paasche Index = 115, Fisher’s Index is:", o: ["117.5", "117.47", "235", "57.5"], a: "117.47" },
    { q: "The formula (Σ P₁Q₁ / Σ P₀Q₁) × 100 represents:", o: ["Laspeyres Price Index", "Paasche Price Index", "Value Index", "Quantity Index"], a: "Paasche Price Index" },
    { q: "If ΣP₀Q₀ = 500, ΣP₁Q₀ = 650, ΣP₀Q₁ = 480, ΣP₁Q₁ = 624, the Paasche Index is:", o: ["130", "124.8", "120", "132.5"], a: "130" },
    { q: "The Value Index is calculated as:", o: ["(Σ P₁Q₀ / Σ P₀Q₀) × 100", "(Σ P₁Q₁ / Σ P₀Q₀) × 100", "(Σ P₀Q₁ / Σ P₀Q₀) × 100", "(Σ P₁Q₁ / Σ P₁Q₀) × 100"], a: "(Σ P₁Q₁ / Σ P₀Q₀) × 100" },
    { q: "If CPI in 2023 = 140 and CPI in 2022 = 125, the inflation rate is:", o: ["15%", "12%", "10.71%", "8%"], a: "12%" },
    { q: "Consumer Price Index is typically based on:", o: ["Paasche’s formula", "Laspeyres’ formula", "Fisher’s formula", "Marshall-Edgeworth formula"], a: "Laspeyres’ formula" },
    { q: "Real income is calculated as:", o: ["Nominal Income × CPI", "Nominal Income + CPI", "(Nominal Income / CPI) × 100", "CPI − Nominal Income"], a: "(Nominal Income / CPI) × 100" },
    { q: "Chain Index uses:", o: ["Fixed base throughout", "Previous period as base for each calculation", "Current period as base", "Geometric mean of all periods"], a: "Previous period as base for each calculation" },
    { q: "Which test is NOT satisfied by Fisher’s Index?", o: ["Time Reversal Test", "Factor Reversal Test", "Circular Test", "Unit Test"], a: "Circular Test" },
    { q: "If nominal salary = ₦600,000 and CPI = 150, the real salary (in base period terms) is:", o: ["₦900,000", "₦400,000", "₦450,000", "₦750,000"], a: "₦400,000" }

];

let questions = [];
let current = 0;
let answers = [];
let timeLeft = 0;
let isReviewMode = false;
let timerInt;

document.getElementById("poolSize").innerText = QUESTION_POOL.length;

/* --- FUNCTIONS --- */
function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function startExam() {
    let qty = parseInt(document.getElementById("userQty").value);
    let mins = parseInt(document.getElementById("userTime").value);

    // Hard Validation Logic
    if (isNaN(qty) || qty < 1) qty = 1;
    if (qty > MAX_QS) qty = MAX_QS;
    if (qty > QUESTION_POOL.length) qty = QUESTION_POOL.length;

    if (isNaN(mins) || mins < 1) mins = 1;
    if (mins > MAX_TIME) mins = MAX_TIME;

    // Apply limits back to UI for transparency
    document.getElementById("userQty").value = qty;
    document.getElementById("userTime").value = mins;

    // Initialize
    questions = shuffle([...QUESTION_POOL]).slice(0, qty);
    timeLeft = mins * 60;
    answers = new Array(qty).fill(null);
    current = 0;
    isReviewMode = false;

    document.getElementById("setupScreen").style.display = "none";
    document.getElementById("examArea").style.display = "block";
    
    createPalette(qty);
    loadQuestion();
    startTimer();
}

function startTimer() {
    clearInterval(timerInt);
    timerInt = setInterval(() => {
        if (isReviewMode) return;
        timeLeft--;
        const m = Math.floor(timeLeft / 60);
        const s = timeLeft % 60;
        document.getElementById("timer").innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        if (timeLeft <= 0) {
            clearInterval(timerInt);
            submitExam(true); // Auto-submit when time is up
        }
    }, 1000);
}

function createPalette(qty) {
    const p = document.getElementById("palette");
    p.innerHTML = "";
    for (let i = 0; i < qty; i++) {
        const btn = document.createElement("button");
        btn.innerText = i + 1;
        btn.onclick = () => { current = i; loadQuestion(); };
        p.appendChild(btn);
    }
}

function loadQuestion() {
    const q = questions[current];
    let html = `<div class="question"><h3>Q${current + 1}. ${q.q}</h3>`;
    
    q.o.forEach(opt => {
        let cls = "option";
        if (isReviewMode) {
            if (opt === q.a) cls += " correct";
            else if (answers[current] === opt) cls += " wrong";
        } else {
            if (answers[current] === opt) cls += " selected";
        }
        const action = isReviewMode ? "" : `onclick="selectAnswer('${opt.replace(/'/g, "\\'")}')"`;
        html += `<div class="${cls}" ${action}>${opt}</div>`;
    });
    
    document.getElementById("questionBox").innerHTML = html;
    updatePalette();
}

function selectAnswer(opt) {
    answers[current] = opt;
    loadQuestion();
}

function nextQ() { if (current < questions.length - 1) { current++; loadQuestion(); } }
function prevQ() { if (current > 0) { current--; loadQuestion(); } }

function updatePalette() {
    const btns = document.querySelectorAll(".palette button");
    btns.forEach((b, i) => {
        b.classList.remove("current", "palette-correct", "palette-wrong");
        if (isReviewMode) {
            if (answers[i] === questions[i].a) b.classList.add("palette-correct");
            else b.classList.add("palette-wrong");
        }
        if (i === current) b.classList.add("current");
    });
}

function submitExam(force = false) {
    if (!force && !confirm("Submit your exam?")) return;
    
    isReviewMode = true;
    clearInterval(timerInt);
    
    let score = 0;
    questions.forEach((q, i) => { if (answers[i] === q.a) score++; });

    document.getElementById("timer").style.display = "none";
    document.getElementById("submitBtn").style.display = "none";
    document.getElementById("resultBanner").style.display = "block";
    document.getElementById("scoreDisplay").innerText = `Final Score: ${score} / ${questions.length}`;
    document.getElementById("percentDisplay").innerText = `${((score/questions.length)*100).toFixed(1)}%`;
    
    current = 0;
    loadQuestion();
}
</script>
</body>
</html>